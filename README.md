## Search Extractor

> _This is and Elixir app that takes some keyword and searches to google and stores some important information._

## Project Setup

### Erlang & Elixir

- Erlang 23.3

- Elixir 1.11.4

- Recommended version manager.

  - [asdf](https://github.com/asdf-vm/asdf)
  - [asdf-erlang](https://github.com/asdf-vm/asdf-erlang)
  - [asdf-elixir](https://github.com/asdf-vm/asdf-elixir)

### Demo

- #### Staging - https://search-extractor-staging.herokuapp.com

- #### Poduction - https://search-extractor.herokuapp.com

### Development

- Install [Docker for Mac](https://docs.docker.com/docker-for-mac/install/)

- Setup and boot the Docker containers:

  ```sh
  make docker_setup
  ```

- Install Elixir dependencies:

  ```sh
  mix deps.get
  ```

- Install Node dependencies:

  ```sh
  npm install --prefix assets
  ```

- Setup the databases:

  ```sh
  mix ecto.setup
  ```

- Start the Phoenix app

  ```sh
  iex -S mix phx.server
  ```

- Run all tests:

  ```sh
  mix test
  ```

- Run all lint:

  ```sh
  mix codebase
  ```

- Test coverage:

  ```sh
  mix coverage
  ```

### Production

- Build Docker image

  ```sh
  docker-compose build
  ```

### CI/CD

We are using heroku to deploy our `staging` and `production` app. There are few steps that needs to be followd to
deploy app successfully to Heroku -

- Create two apps in heroku. One for `staging` and one for `production`.
- Add below [secrets](https://docs.github.com/en/actions/reference/encrypted-secrets) to github -

  | Secrets               | Description                                                                         |
  | --------------------- | ----------------------------------------------------------------------------------- |
  | HEROKU_API_KEY        | Can be found under [Account settings](https://dashboard.heroku.com/account#api-key) |
  | HEROKU_STAGING_APP    | The heroku app name created for staging environment                                 |
  | HEROKU_PRODUCTION_APP | The heroku app name created for production environment                              |

- Add a [PostgreSql Database add-on](https://devcenter.heroku.com/articles/managing-add-ons#using-the-dashboard) to
  heroku app.
- Add below environment variables to heroku app -

  | Environment Variable | Description                                                                    |
  | -------------------- | ------------------------------------------------------------------------------ |
  | DATABASE_URL         | Will be added automatically after adding the database add-on to the Heroku app |
  | HOST_URL             | The URL host, e.g. `acme.herokuapp.com`                                        |
  | SECRET_KEY_BASE      | The value generated by running the command `mix phx.gen.secret`                |

- Push to `development` branch will deploy to `staging` and push to `main` branch will deploy to production.
